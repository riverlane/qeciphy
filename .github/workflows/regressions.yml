name: CI Pipeline
on:
  pull_request:
    branches: [main]

jobs:
  # Static analysis jobs that must pass before expensive FPGA jobs
  static-checks:
    runs-on: sanity-builder
    environment: ci
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
      - name: Check code formatting
        run: |
          bash ci/format.sh
      - name: Lint FPGA code
        run: |
          bash ci/lint.sh

  # FPGA jobs that only run if static checks pass
  fpga-simulation:
    needs: static-checks
    runs-on: sanity-builder
    environment: ci
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
      - name: Run simulations
        run: |
          bash ci/sim.sh

  fpga-synthesis:
    needs: static-checks
    runs-on: sanity-builder
    environment: ci
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
      - name: Run synthesis
        run: |
          bash ci/synth.sh
